{% extends 'base.html' %}
{% load embed_video_tags %}
{% block content %}

<section id="detail">

<div class="">
  <div class="">
    <h3>
      {{ teacher.first_name }}'s Lessons
    </h3>

    {% for photo in teacher.photo_set.all %}
      <img src="{{photo.url}}">
        {% if user.is_authenticated and user.id == teacher.user_id %}
          <form action="{% url 'delete_photo' photo.profile.id %}" method="POST">
            {% csrf_token %}
            <button type="submit">
              Delete Photo
            </button>
          </form>
        {% endif %}
    {% endfor %}

    <p>Email: <a href="mailto:{{ teacher.user }}">{{ teacher.user }}</a></p>
    <p>Location: {{ teacher.location }}</p>
    <p>Bio: {{ teacher.bio }}</p>

    {% if user.is_authenticated and user.id == teacher.user_id %}
      <p><a href="{% url 'teachers_update' teacher.id %}">Update Profile</a></p>

      {% if teacher.photo_set.all|length > 0 %}
      {% else %}
      <form action="{% url 'add_photo' teacher.id %}" enctype="multipart/form-data" method="POST" class="card-panel">
      {% csrf_token %}
      <input type="file" name="photo-file">
        <br> <br>
      <input type="submit" class="btn" value="Upload Photo">
    </form>

      {% endif %}
    {% endif %}

    {% if user.is_authenticated %}
      <form action="{% url 'add_lesson' teacher.id %}" method="POST">
        {% csrf_token %}
        <table>
          {{ lesson_form.as_table }}
        </table>
        <input type="submit" value="Add Lesson" class="btn">
      </form>

      {% for lesson in teacher.lesson_set.all %}

      <div class="lesson-container">
        <div class="lesson-info">
          <p>
            {{ lesson.date }} | {{ lesson.time }} | {{ lesson.instrument }} | Extra Info: {{ lesson.description }}
          </p>
        </div>
        <div class="lesson-video">
          {% video lesson.video 'medium' %}
        </div>
      </div>

      {% endfor %}

  </div>
</div>

  <p>
    {% else %}
    <a href="{% url 'signup' %}"><button>Book A Lesson</button></a>
  </p>

{% endif %}

{% endblock %}
